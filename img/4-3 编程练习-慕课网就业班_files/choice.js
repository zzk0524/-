define("lesson/js/choice",["lesson/js/common"],function(t){var n=function(t){this.init(t)};return n.prototype={optionPannel:"#choice-pannel",tabPannel:"#choice-tab",contPannel:"#cont-pannel",init:function(t,n){this.properties(),n||this.bindEvents(),this.navTabRender({info:this.tabData,chapter_media:App.MEDIAINFO.chapter_media}),this.Render(),t&&t()},properties:function(){this.tabData=App.MEDIAINFO.select_id,this.sid=this.tabData[0].type_id,this.num=1,this.select_title=App.MEDIAINFO.select_title,this.type=App.MEDIAINFO.select_type,this.dataInfo=App.MEDIAINFO.info,this.optionJson=null,this.optionJson={},this.optionNum=0,this.Data=[],this.tip=App.MEDIAINFO.tip},Render:function(n){var e=this,n=n||this.dataReorgani(this.num,this.dataInfo);this.contRender(),this.choiceRender(n);var i={};$.each(this.Data,function(t,s){return s.key==e.num?(i.type=n.checked?"submit":"",i.redo=n.num>1?!1:!0,!1):void 0}),this.btnRender(i),$("#choice-scrollbar").scrollTop(0),t.emit("lesson.resize")},optionChange:function(t){this.optionJson[t.sid]=t.type,this.optionNum++;var n=$(this.tabPannel);$.each(this.optionJson,function(e,i){t.sid==e&&(i?n.find(".option"+e).removeClass("erro").addClass("succ"):n.find(".option"+e).removeClass("succ").addClass("erro"))})},optionDelete:function(t){$(this.tabPannel).find(".option"+t).removeClass("erro").removeClass("succ"),this.optionNum--,delete this.optionJson[t]},bindEvents:function(){var n=this;t.on("Choice.optionChange",function(t,e){n.optionChange(e)}),$(this.optionPannel).on("click",".js-submit",function(){n.submit(),$("#cont-scrollbar").scrollTop(0),$("#choice-scrollbar").scrollTop(0)}).on("click",".item",function(){n.itemEvent($(this))}).on("click",".js-redo",function(){n.redo()}).on("click",".js-next",function(){n.next()}).on("click",".js-nextm",function(){window.location.href=App.NEXTMEDIAINFO?"#mid="+App.NEXTMEDIAINFO.id:OP_CONFIG.curCourse.href}),$(this.tabPannel).on("click","li",function(){if(!$(this).hasClass("active")){$(this).addClass("active").siblings("li").removeClass("active");var t={};t.sid=$(this).attr("data-id"),n.num=$(this).html(),n.switchChoice(t)}}).on("click",".prev",function(){return $(this).hasClass("not")?void $.alert("已经是第一个选择题了~"):(n.prev(),!1)}).on("click",".next",function(){return $(this).hasClass("not")?void $.alert("已经是最后一个选择题了~"):(n.next(),!1)}),$(document).on("click",".js-open-answer",function(){$(this).html("<span class='txt'>收起解析</span><span class='imv2-arrow1_u'></span>"),$(this).removeClass("js-open-answer").addClass("js-close-answer"),$(".answerBox").show("fast")}),$(document).on("click",".js-close-answer",function(){$(this).html("<span class='txt'>展开解析</span><span class='imv2-arrow1_d'></span>"),$(this).removeClass("js-close-answer").addClass("js-open-answer"),$(".answerBox").hide("fast")})},prev:function(){var t=this,n=$(this.tabPannel).find(".active");n.prev("li").trigger("click"),t.notHandle()},next:function(){var t=this,n=$(this.tabPannel).find(".active");n.next("li").trigger("click"),t.notHandle()},notHandle:function(){var t=$(this.tabPannel),n=t.find(".active");n.prev("li")[0]?t.find(".prev").removeClass("not"):t.find(".prev").addClass("not"),n.next("li")[0]?t.find(".next").removeClass("not"):t.find(".next").addClass("not")},switchChoice:function(t){App.showPageLoad();var n=this,e={},i=!1;$.each(n.Data,function(t,s){return n.num==s.key?(i=!0,e=s,!1):void 0}),$.post("/course/PracticeInfo",t,function(s){1==s.result?(n.sid=t.sid,n.dataInfo=s.data.info,n.select_title=s.data.select_title,n.type=s.data.select_type,i?n.Render(e):n.Render()):$.alert(s.msg),App.hidePageLoad()},"json")},itemEvent:function(t){var n=$(this.optionPannel).find(".js-submit");if(!n[0])return!1;var e=t.parents("#choicebox"),i=e.hasClass("multi");t.hasClass("active")?t.removeClass("active"):(t.addClass("active"),i||t.siblings(".item").removeClass("active"))},submit:function(){var n=this,e={};return e.sid=this.sid,e.oid="",e.tid="",$(this.optionPannel).find(".item").each(function(i){if($(this).hasClass("active")){var s=$(this).attr("data-id");e.oid+=s+=",",e.tid+=t.converType(i)+",",$.each(n.Data,function(t,e){n.num==e.key&&(e.info[i].checked=!0)})}}),e.oid=e.oid.substr(0,e.oid.length-1),e.tid=e.tid.substr(0,e.tid.length-1),""==e.oid?($.alert("你还没做选择"),!1):void n.submitCallback(e)},submitCallback:function(n){var e=this,i=!1;$.each(this.Data,function(s,a){a.key==e.num&&(a.answer==n.tid&&(i=!0),a.num++,a.checked=n.tid,i&&(a.success=!0),t.emit("Choice.optionChange",{sid:n.sid,type:i}),e.choiceRender(a),a.checked&&$("#choice-scrollbar").scrollTop(1e4),t.emit("lesson.resize"),e.btnRender({type:"submit",redo:a.num>1?!1:!0,next:!1}))}),e.optionNum==e.tabData.length&&t.emit("lesson.finish")},redo:function(){var t=this;$.each(this.Data,function(n,e){e.key==t.num&&(e.checked=!1,e.success=!1,$.each(e.info,function(t,n){n.checked=!1}),t.choiceRender(e),t.btnRender(),t.optionDelete(t.sid))})},btnRender:function(t){var t=t||{};"undefined"!=typeof t.type&&("submit"!=t.type||$(this.tabPannel).find(".active").next("li")[0]||(App.NEXTMEDIAINFO?t.next=!0:t.course=!0)),btnTpl=$("#choiceBtn-tpl").html(),btnHtmls="",btnHtmls=juicer(btnTpl,{data:t}),$(this.optionPannel).find(".choice-btnwrap").html(btnHtmls)},navTabRender:function(t){tabTpl=$("#choicetab-tpl").html(),tabHtmls="",tabHtmls=juicer(tabTpl,{data:t}),$(this.tabPannel).html(tabHtmls)},contRender:function(){var t=this.num||1,n="";n+='<div class="cont-title-wrap">',n+='<div class="cont-title">',n+="<span>"+t+". </span>",n+=1==this.type?"单选题":"多选题",n+="</div>",n+='<div class="cont-desc ueword">',n+=this.select_title,n+="</div>",$(this.contPannel).find(".content").html(n)},choiceRender:function(t){t.type=this.type;var n=$("#choicelist-tpl").html(),e="";e=juicer(n,{data:t}),$(this.optionPannel).find(".inner").html(e)},dataReorgani:function(n,e){var i={};i.key=n,i.info=[],i.checked=!1,i.success=!1,i.num=0,i.tip=this.tip,i.answer="",i.later=OP_CONFIG.later;for(var s=0;s<e.length;s++)i.info.push({type:t.converType(s),id:e[s].id,name:e[s].name,checked:!1}),1==e[s].is_answer&&(i.answer+=t.converType(s)+",");return i.answer=i.answer.substr(0,i.answer.length-1),this.Data.push(i),i}},{init:function(t){return new n(t)}}});