define("lesson/js/asidebar",["lesson/js/common","sc/js/inc/qa-search","ueditor"],function(t){var e={},i={},a={};e={init:function(){this.bindEvents(),this.properties(),$("#lessonLeft").on("click",function(){e()}),$("#lessonRight").on("click",function(){e()});var e=function(){$("#chapterlist").hasClass("active")&&$("#asidebar .js-chapter").click(),$("#sourcelist").hasClass("active")&&$("#asidebar .js-source").click()},i=$("#note-scrollbar"),a=$("#qa-scrollbar");t.on("lesson.resize",function(){t.scrollbar.init(i),t.scrollbar.init(a)})},Api:{loadChapterlist:"/lesson/chapterlist"},properties:function(){this.$chapterlist=$("#chapterlist"),this.$sourcelist=$("#sourcelist")},bindEvents:function(){var t=this;$("#asidebar").on("click",".js-chapter",function(){t.onChapters()}),$("#asidebar").on("click",".js-wenda",function(){t.onWendaList(),n(".captcha-verify-box")}),$("#asidebar").on("click",".js-note",function(){$(this).addClass("on"),t.onNoteList(),n(".captcha-verify-box")}),$("#asidebar").on("click",".js-source",function(){t.onSource()})},onChapters:function(){var t=App.MEDIAINFO.id,e=this.$chapterlist.hasClass("active");e?($(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active")):($(".js-chapter").addClass("on"),$(".js-source").removeClass("on"),this.$sourcelist.removeClass("active"),this.$chapterlist.addClass("active")),t!=this.$chapterlist.data("mid")&&(this.$chapterlist.data("mid",t),this.loadChapters())},onSource:function(){var e=(App.MEDIAINFO.id,this.$sourcelist.hasClass("active"));e?($(".js-source").removeClass("on"),this.$sourcelist.removeClass("active")):($(".js-source").addClass("on"),$(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active"),this.$sourcelist.addClass("active"));var i=$("#source-scrollbar");t.scrollbar.init(i)},loadChapters:function(){var t=this,e={};e.mid=$("#chapterlist").data("mid"),e.cid=OP_CONFIG.curCourse.id,$.post(t.Api.loadChapterlist,e,function(e){0==e.result?t.RendeChapters(e.data):$.alert(e.msg)},"json")},RendeChapters:function(e){if(e.length>0){var i=$("#chapter-tpl").html(),a="",s=1;2==OP_CONFIG.later&&(s=2),a=juicer(i,{data:e,later:s})}else a="";if($("#chapterlist").removeClass("loading").find(".js-chapterlist").html(a),e.length>0){var n=$("#chapter-scrollbar");t.scrollbar.init(n,function(){var e=n.find(".cur"),i=e.parent(),a=0,s=n.height();a=i.position().top,a>s&&(n.scrollTop(a-i.height()),t.scrollbar.update(n))})}},onWendaList:function(){var e=App.MEDIAINFO.id,a=$("#qa-pannel");"visible"==a.css("visibility")?($("#lessonwrap").hasClass("renewal")&&$("#lessonDrag").hide(),$(".js-wenda").removeClass("on"),$(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active"),t.Pannel.wenda.hide(),i.delSearchWrap(),"imageText"==App.MEDIAMODE&&($("#lessonLeft").width("100%"),$("#lessonRight").css("left","100%"),$("#lessonDrag").hide())):($(".js-wenda").addClass("on"),$(".js-note").removeClass("on"),$(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active"),t.Pannel.wenda.show(),"imageText"==App.MEDIAMODE&&($("#lessonLeft").width("60%"),$("#lessonRight").css("left","60%"),$("#lessonDrag").show())),e!=a.data("mid")&&(a.data("mid",e),this.initList("wenda"))},onNoteList:function(){var e=this,i=App.MEDIAINFO.id,a=$("#note-pannel"),s="visible"==a.css("visibility");s?($("#lessonwrap").hasClass("renewal")&&$("#lessonDrag").hide(),$(".js-note").removeClass("on"),$(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active"),t.Pannel.note.hide(),"imageText"==App.MEDIAMODE&&($("#lessonLeft").width("100%"),$("#lessonRight").css("left","100%"),$("#lessonDrag").hide())):($(".js-note").addClass("on"),$(".js-wenda").removeClass("on"),$(".js-chapter").removeClass("on"),this.$chapterlist.removeClass("active"),t.Pannel.note.show(),"imageText"==App.MEDIAMODE&&($("#lessonLeft").width("60%"),$("#lessonRight").css("left","60%"),$("#lessonDrag").show())),i!=a.data("mid")&&(a.data("mid",i),e.initList("note"))},initList:function(t){"wenda"==t?i.init():"note"==t&&a.init()},__scrollbar:function(e,i,a,s){if(t.scrollbar.init(i),null!=e&&1==e.data.page.page){var n=a.find(".pagination"),o={};e.data.page&&e.data.page.total>e.data.page.pageSize?(o=e.data.page,n.pagination(o.total,{prev_text:"上一页",next_text:"下一页",items_per_page:o.pageSize,num_display_entries:3,num_edge_entries:2,callback:function(t){s&&s(t)}})):n.html("")}else null==e?(a.find(".pagination").html(""),i.scrollTop(0),t.scrollbar.update(i)):(i.scrollTop(0),t.scrollbar.update(i))}};var s="",n=function(t){$(t).addClass("hide").html(""),s=""};$(document).on("click",".js-mocaptcha-close",function(){$(".captcha-verify-box").addClass("hide").html(""),s=""});var o,r=1,l=!0,c=!0;return i={Api:{verifycode:function(){var t=new Date;return"/course/verifycode?_t=addqa&v="+t.getTime()},loadList:"/lesson/ajaxqa",addqa:"/course/addqa",searchqa:"/lesson/searchques",setTop:"/lesson/settop"},properties:function(){this.askBox=$(".wenda-ask-box")},init:function(){this.initN&&(this.bindEvents(),this.initN=!1),this.loadList()},initN:!0,loadList:function(t,e){var i=this;if(2==OP_CONFIG.later)var t=t||"myquestion";else var t=t||"all";var e=e||0,a={};a.mid=App.MEDIAINFO.id,a.page=e+1,a.t=t;var s=i.Api.loadList;"search"==t&&(s=i.Api.searchqa,a.cid=App.MEDIAINFO.course_id,a.words=$(".qa-input-text").val()),$.post(s,a,function(e){0==e.result?(i.RendeList(e,t),"search"==t&&($(".js-qanav a").removeClass("cur"),$(".asidbar-search-tab").show().addClass("cur"))):$.alert(e.msg)},"json")},RendeList:function(t,i){var a=this,s=$("#wenda-tpl").html(),n="",o=$("#qa-scrollbar"),r=t.data.list,l=t.data.uInfo;if(r&&r.length>0){var c=!1;r[5]&&r[4].set_top_time>0&&(c=!0),n=juicer(s,{data:{list:r,ulimit:OP_CONFIG.ulimit,current:i,uid:OP_CONFIG.userInfo.uid,showTopMenu:l.showTopMenu,hasFiveTop:c}}),$("#wendalist").html(n),e.__scrollbar(t,o,$("#qa-pannel"),function(t){a.loadList(i,t)})}else 2==OP_CONFIG.later?n="myquestion"==i?'<p class="notdata">你还没有发布任何的提问</p>':'<div class="renewal-text">								<p>您的教学服务已到期<br>如需使用完整的问答功能请续费</p>								<a class="go-renewal moco-btn moco-btn-purple js-renew" href="javascript:void(0);">我要续费</a>							</div>':"all"==i?n='<p class="notdata">暂无相关问答</p>':"pending"==i?n='<p class="notdata">暂无待解决问答</p>':"myquestion"==i?n='<p class="notdata">你还没有发布任何的提问</p>':"myanswer"==i?n='<p class="notdata">你还没有回复任何的提问</p>':"search"==i&&(n='<p class="notdata">暂无相关问题，您可点击“提问”提交</p>'),$("#wendalist").html(n),e.__scrollbar(null,o,$("#qa-pannel"))},showAskBox:function(){var t=$("#wenda-ask-modal-tpl").html(),e=($("body"),this),i={value:"",id:r};0==$(".js-wenda-ask-box").length&&(i.value=$(".qa-input-text").val(),$.dialog(juicer(t,i),{title:"我要提问",width:780,height:396,modal:!0}),e.properties(),e.initUEditor(),l=!0)},removeAskBox:function(){$(".js-wenda-ask-box").remove(),$(".js-wenda-block").remove(),$(".wenda-ask-loading").remove()},initUEditor:function(){var t=this,e="editQuestionEditor"+r;t.id=e,UE.delEditor(o),o=UE.getEditor(e,{initialFrameHeight:124,initialFrameWidth:"100%",autoFloatEnabled:!1,autoClearinitialContent:!0,autoHeightEnabled:!1,initialStyle:"p{line-height:24px; font-size:14px; color:#4d555d;}#initContent {color: #93999F;}"}),o.on("ready",function(){var t=this;setTimeout(function(){$(t.container).find(".edui-editor-iframeholder").addClass("tag")})}),o.addListener("focus",function(){$(this.container).find(".edui-editor-iframeholder").removeClass("tag")}),o.addListener("blur",function(){""==o.getContent()&&$(this.container).find(".edui-editor-iframeholder").addClass("tag")}),r++},initVerifyCode:function(){var e=t.RenderQrcodeTpl(this.Api.verifycode());this.askBox.find(".wenda-ask-bottom").prepend(e)},updateVerCode:function(){$(".js-codeimg").attr("src",this.Api.verifycode()),$(".verify-text").val("")},bindEvents:function(){var t=this;2==OP_CONFIG.later&&($(".js-submit-box").on("mouseover",function(){$(this).siblings(".js-later-tip").show().css({right:"17px",top:"40px"})}),$(".js-submit-box").on("mouseout",function(){$(this).siblings(".js-later-tip").hide()}),$(".js-later-tip").on("mouseover",function(){$(this).show()}),$(".js-later-tip").on("mouseout",function(){$(this).hide()}),$(".search-qa-btn").on("mouseover",function(){$(this).siblings(".js-later-tip").show().css({right:"116px",top:"32px"})}),$(".search-qa-btn").on("mouseout",function(){$(this).siblings(".js-later-tip").hide()})),$(".qa-input-button").on("click",function(){return l?(l=!1,void t.showAskBox()):void $.prompt("响应中，请稍等~",{icon:"error"})}),$("body").on("click",".js-wenda-ask-save",function(){return c?void t.addqa():void $.prompt("请求中，请稍后~",{icon:"error"})}),$("body").on("click",".wenda-ask-box .js-codeimg",function(){t.updateVerCode()}),$("body").on("click",".wenda-ask-box .js-imv2-refresh",function(){t.updateVerCode()}),$(".js-qanav").on("click","a",function(){var e=$(this),i=e.attr("data-type");e.siblings("a").removeClass("cur"),e.addClass("cur"),t.loadList(i)}),$("#qa-pannel").on("click",".js-close",function(){$("#qa-pannel").hasClass("active")&&$("#asidebar .js-wenda").click()}),$("body").on("click",".js-refresh",function(){t.captchaRefresh()}),$(".qa-input-text").unbind("keyup"),$(".qa-input-text").on("keyup",function(){var e=$(this).val();""==e?($(".qa-input-close").hide(),t.delSearchWrap()):$(".qa-input-close").show()}),$(".qa-input-close").on("click",function(){t.delSearchWrap()}),$(".js-close-searchTab").on("click",function(e){e.stopPropagation(),t.delSearchWrap()}),$(document).on("click",".js-search-qa",function(){t.searchQa()}),$(document).on("click",".js-setTop",function(){t.setTop(this)})},captchaRefresh:function(){var t="/course/verifycode?_t=addqa&a="+Math.random();$(".js-captcha").attr("src",t)},showError:function(t,e){t.html(e)},hideError:function(){this.askBox.find(".wenda-ask-title").next(".wenda-ask-error").html(""),$("#editQuestionEditor"+(r-1)).next(".wenda-ask-error").html("")},addqa:function(){var t=this,e=t.askBox.find(".wenda-ask-title");this.hideError();var i={};return i.mid=App.MEDIAINFO.id,i.title=e.val(),i.content=o.getContent(),i.title.length<5?(this.showError(e.next(".wenda-ask-error"),"标题不能小于5个字符"),!1):i.title.length>50?(this.showError(e.next(".wenda-ask-error"),"标题不能多于50个字符"),!1):$.trim(i.content).length<5?(this.showError($("#editQuestionEditor"+(r-1)).next(".wenda-ask-error"),"内容不能少于5个字符"),!1):$.trim(i.content).length>1e5?(this.showError($("#editQuestionEditor"+(r-1)).next(".wenda-ask-error"),"内容不能多于100000个字符"),!1):(c=!1,void $.post(t.Api.addqa,i,function(e){0==e.result?($.prompt("问题添加成功！"),$(".js-qanav a")[2].click(),$(".js-modal-close").trigger("click"),c=!0):(-103002==e.result?($(".js-captcha-errText").html(e.msg).show(),t.captchaRefresh()):$.alert(e.msg),c=!0)},"json"))},refreshList:function(t){this.loadList(t)},searchQa:function(){this.loadList("search")},delSearchWrap:function(){$(".qa-input-text").val(""),$(".qa-input-close").hide(),$(".asidbar-search-tab").hide(),this.loadList();var t;t=2==OP_CONFIG.later?3:1,$(".js-qanav a:nth-child("+t+")").addClass("cur").siblings("a").removeClass("cur")},setTop:function(t){var e=this,i=$(t).data("settop"),a={question_id:$(t).data("id")};0==i?a.op_type=1:1==i&&(a.op_type=2),$.post(e.Api.setTop,a,function(t){if(0==t.result){$.prompt(0==i?"置顶成功！":"取消置顶成功！");var a=$(".js-qanav").find(".cur").data("type");e.refreshList(a)}else $.prompt(0==i?"置顶失败！":"取消置顶失败！",{icon:"error"})},"json")}},a={Api:{verifycode:function(){var t=new Date;return"/course/verifycode?_t=addnote&v="+t.getTime()},loadList:"/lesson/ajaxnote",addnote:"/course/addnote"},init:function(){if(this.initN){var e=$("#note-pannel");this.bindEvents();var i=t.RenderQrcodeTpl(this.Api.verifycode());e.find(".Qrcode-wrap").html(i),this.initN=!1}this.loadList()},initN:!0,loadList:function(t,e){var i=this,t=t||"all",e=e||0,a={};a.mid=OP_CONFIG.mid,a.page=e+1,a.t=t,$.post(i.Api.loadList,a,function(e){0==e.result?i.RendeList(e,t):$.alert(e.msg)},"json")},RendeList:function(t,i){var a=this,s={},n=$("#note-scrollbar"),o=$("#note-tpl").html(),r="";s.list=t.data.list,s.uid=OP_CONFIG.userInfo.uid,s.nickname=OP_CONFIG.userInfo.nickname,s.t=t.data.t,s.list.length>0?(r=juicer(o,{data:s}),$("#notelist").html(r),e.__scrollbar(t,n,$("#note-pannel"),function(t){a.loadList(i,t)})):(r='<p class="notdata">暂无相关笔记</p>',$("#notelist").html(r),e.__scrollbar(null,n,$("#note-pannel")))},$noteWrap:$("#note-pannel"),$FormParent:$("#noteForm"),$listParent:$("#notelist"),bindEvents:function(){var t=this;$(".js-notenav").on("click","a",function(){var e=$(this),i=e.attr("data-type");e.siblings("a").removeClass("cur"),e.addClass("cur"),t.loadList(i)}),t.$FormParent.on("click",".js-save",function(){t.save($(this))}),t.$listParent.on("click",".js-edit",function(){t.editShow($(this))}),t.$listParent.on("click",".js-cancel",function(){t.editHide($(this))}),t.$listParent.on("click",".js-save",function(){t.revised($(this))}),t.$listParent.on("click",".js-delete",function(){var e=$(this);$.confirm("你确定要删除这条笔记吗？",{callback:function(){t.rmNote(e)}})}),t.$listParent.on("click",".js-favor",function(){t.favorNote($(this))}),t.$listParent.on("click",".js-collect",function(){t.collectNote($(this))}),t.$listParent.on("mousewheel",".edit-area",function(t){t.stopPropagation()}),t.$listParent.on("click",".js-lookimg-trigger",function(){var t=$(this).parents(".attachment").find(".js-lookimg img");t.trigger("click")}),moco.imagePreview.init("#notelist"),t.$noteWrap.on("click",".switch-wrap",function(){var t=$(this).find(".switch"),e=t.hasClass("on");e?t.removeClass("on").html('<i class="imv2-checkbox_onk"></i>'):t.addClass("on").html('<i class="imv2-checkbox"></i>')}),$("#note-pannel").on("click",".js-close",function(){$("#asidebar .js-note").click()})},save:function(t){var e=this,i=e.$FormParent.find("textarea");i.next(".error").html("");var a=i.val(),s={};return s.mid=OP_CONFIG.mid,s.share=e.$FormParent.find(".share").hasClass("on")?1:0,""==$.trim(a)?(i.next(".error").html("笔记内容不能为空！"),!1):$.trim(a).length>2e3?(i.next(".error").html("笔记内容不能多于2000个字符！"),!1):(s.content=a,"video"==App.MEDIAMODE&&e.$FormParent.find(".pic").hasClass("on")&&(s.pic_time=App.picTime()),"code"==App.MEDIAMODE&&e.$FormParent.find(".pic").hasClass("on")&&(s.files=App.getFiles),t.attr("disabled",!0),t.val("提交中..."),void $.post(e.Api.addnote,s,function(a){if(0==a.result){var s=$(".js-notenav").find(".cur").data("type");e.refreshList(s),$.prompt("笔记添加成功！",{callback:function(){t.attr("disabled",!1),t.val("提交")}}),i.val(""),i.next(".error").html(""),zhuge&&zhuge.track("PublishNotes",{Platform:"web",Category:"就业班",CID:OP_CONFIG.curCourse.id})}else $.alert(a.msg,{callback:function(){t.attr("disabled",!1),t.val("提交")}})},"json"))},editShow:function(t){var e=t.parents(".note-item");e.addClass("edit"),e.find(".edit-area").focus(),e.find(".error").html("")},editHide:function(t){var e=t.parents(".note-item"),i=e.find(".edit-area");e.removeClass("edit"),i.val($.trim(e.find(".content").text()))},revised:function(t){var e=this,i={},a=t.parents(".note-item"),s=a.find(".edit-area"),n=s.val();return i.id=a.attr("data-noteid"),""==$.trim(n)?(s.next().find(".error").html("笔记内容不能为空！"),!1):$.trim(n).length>2e3?(s.next().find(".error").html("笔记内容不能多于2000个字符！"),!1):(i.content=n,void $.post("/course/editnote",i,function(s){0==s.result?($.prompt("笔记修改成功！"),a.find(".content").text(i.content),e.editHide(t)):$.alert("修改失败")},"json"))},rmNote:function(t){var e=this,i=t.parents(".note-item"),a={};a.id=i.attr("data-noteid"),$.post("/course/deletenote",a,function(t){if(0==t.result){$.prompt("删除成功");var i=$(".js-notenav").find(".cur").data("type");e.refreshList(i)}else $.alert("删除失败")},"json")},favorNote:function(t){var e=t.parents(".note-item"),i=t.find("span").html()-0,a={};a.id=e.attr("data-noteid"),a.option=1==e.attr("data-option")?0:1,$.post("/course/supportnote",a,function(s){0==s.result?1==a.option?(e.attr("data-option",1),t.find("span").html(i+1),t.addClass("favored").attr("title","取消赞")):(e.attr("data-option",0),t.find("span").html(i-1),t.removeClass("favored").attr("title","赞")):$.prompt(s.msg,{icon:"error"})},"json")},collectNote:function(t){var e=t.parents(".note-item"),i=t.parents(".bottom-r"),a={};a.id=e.attr("data-noteid"),$.post("/course/collectnote",a,function(e){0==e.result?(i.find(".collect-num").html(i.find(".collect-num").html()-0+1),t.removeClass("collect js-collect").html("已采集"),zhuge&&zhuge.track("PublishNotes",{Platform:"web",Category:"就业班",CID:OP_CONFIG.curCourse.id})):$.prompt(e.msg,{icon:"error"})},"json")},refreshList:function(t){this.loadList(t)}},window.wendacmd=i,e});